# Web技術とスマホで始める電子工作入門

基板を買わなければ、積み基板は生まれません。
そもそも作りたいものに基板は必要でしょうか？
よくよく考えてみると、作りたいものはスマートフォンのセンサーや機能で代替できるかもしれません。

## はじめに

本章ではスマートフォンでセンサーやカメラを利用したアプリケーションを作る際に知っておきたいAPIや、開発する際に知っておきたいTipsを紹介します。
また、App StoreやGoogle Playで配布されるネイティブアプリではなく、ウェブブラウザで動作するウェブアプリを対象とします。

ネイティブアプリはスマートフォンのハードウェアにアクセスできる範囲は大きいですが、開発環境を整えるために、SDKのインストールが必要だったり、開発する際に特定のOSが必要なこともありハードルが高めです。
一方、ウェブアプリはネイティブアプリほど自由度はありません。しかし、開発環境の構築が簡単で、プログラミングには書籍や教材の多いJavaScriptを使用するため入門に適しています。

### 事前知識

本章では簡単なHTMLとJavaScriptの知識を前提にしています。
電子工作に興味がある方であれば、JavaScriptやそれに類する言語の経験をお持ちかもしれません。
あまり経験がない方は、自信がない方はJavaScript Primerでの学習をオススメします。

https://jsprimer.net/

## ウェブ技術でアクセスできるハードウェア機能
通常ブラウザで動くJavaScriptでは、サーバーとの通信やDOM操作に使われるイメージが強いですが、スマートフォンに搭載されるカメラやセンサー類にアクセスできるAPIが用意されています。
これらのAPIを利用すれば電子工作でやりたかったことが実現できるかもしれません。
そこでJavaScriptでハードウェアを操作するAPIをいくつか紹介します。

### カメラの操作

#### 映像の取り込み

スマートフォンのカメラで撮った映像を取り込む方法を紹介します。

`getUserMedia`メソッドを利用すると、動画や音声が含まれるMediaStreamというストリームが帰ってきます。このストリームをあらかじめ用意したvideo要素にわたすと、カメラで撮影している映像が再生されます。

```html
<html>
  <video id="video"></video>
  <script>
    navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then(stream => {
      const video = document.querySelector('video');
      video.srcObject = stream;
      video.play();
    });
  </script>
</html>
```

カメラで撮影している映像を加工する場合はHTMLのCanvas要素を利用します。Canvas要素は、お絵かきチャットや3Dコンテンツの表示などの用途に使われますが、カメラで撮影している映像の表示にも使えます。

次のコードは、カメラで取得した映像をCanvasにレンダリングするものです。

```html
```

#### 画像の加工

Canvasには描写されている画像データを取得する`getImageData`というメソッドと、事前に用意した画像データを反映する`pushImageData`というメソッドが用意されています。
取得できるデータの中には各ピクセルに含まれるRGBA値が格納されている、このデータを加工し、それを反映することでフィルターのような効果を与えられます。

ImageDataのデータについて説明します。ImageDataはwidth, height, dataのプロパティを持ちwidthは幅、heightは高さ、dataがピクセルの色情報を持つデータです。
たとえば、dataが`[0,0,0,0, 255, 255, 255, 255]`だった場合、2ピクセルのデータで、1つ目のピクセルが`R: 0, B: 0, G: 0, A: 0`（透明な黒）、2つめのピクセルが`R: 255, B: 255, G: 255, A: 255`（不透明な白）であることを示しています。

ImageDataを使った例を示します。

```html
```

#### カメラ映像の加工

カメラ画像の取り込みと、画像の加工例を示しました。
最後にこれらを組み合わせ、撮影している映像にリアルタイムでフィルターを適用する例を示します。

```html
```

#### コラム: Slackとかに送る

### センサーの利用

スマホに搭載されている加速度センサーやジャイロセンサーもJavaScriptから利用できます。
端末の向きを利用したい場合は`DeviceOrientationEvent`、端末の動きを利用したい場合は`DeviceMotionEvent`というイベントが用意されています。

## 開発中に注意すること

### ユーザーの同意

### iOS, Android間の差異
