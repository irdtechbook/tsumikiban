# 挫折に至る理由2

前章では、挫折に至る理由を、モチベーションや周辺に関する点で述べました。作りたいものがない、モチベーションがなくなる、具体的な情報がない、といった観点で述べました。本章では、もう少し電子工作やデバイスに関する観点での課題や難点について述べます。

本章に書いてある内容は、いずれも非常にネガティブに見えるかもしれません。「実際難しい理由」を意図的に取り上げています。もちろん対応策がありますし、こういうこともある、という風に読んでいただければ幸いです。

## 挫折・積み基板を増やす要因
いくつもの要因がありますので、それぞれ取り上げましょう。繰り返しになりますが、難しい理由はありますが、対応策はあります。このネガティブな項目の反対を行けばよいのです。

* 作りたいモノがない
* Lチカとその次の断崖っぷり
* パワー系ムズイ
* センサームズイ
* 通信ムズイ
* 画面表示には通信必須
* データシート読めない



### 作りたいものがない
作りたいものを見つけて、要件定義することが非常に重要であることは、前章で述べました。ぜひそちらを参照ください。

繰り返しになりますが、どんなデバイス/ボードをつかうか、どう実現するかは手段であり、目的ではありません。

手段を目的にするのは楽しいものですが・・・

ボードを使うということが目的になると、積み基板がどんどん増えていきます。あるいは、入手・購入すること自体が目的化することもあるでしょう。

### Lチカとその次の断崖っぷり

まずは、Lチカまで完了しました。お疲れさまでした。デビューおめでとうございます。

さて、ではその次に何をやりましょうか？

なお、Lチカを無意味だというつもりは全くありません。Lチカ自体は非常に重要な動作検証であり、プログラミングそのものがきちんと行えることの確認です。ボード自体が正常に動作すること、PCとの通信・接続や開発環境、電源、ポート指定などすべてが正常であって初めて達成されるものです。ソフトウエア開発でいうところのHello Worldと同様か、それ以上の重要性を持ちます。

Lチカを完了させるまでに必要なコードはたいてい数行です。しかもLED以外のものは必要ありません。（本当は電流制限抵抗を付けた方がよい。短時間ならまあ…)

何かを作ろうとしたとき、必要な部品やコードは一気に増えます。外部の情報を得るためのセンサ、信号を入力するためのスイッチ、対象を制御するためのアクチュエーター、何かを表示するためのモニタ、そういったものが増えます。しかもたいていは一つではありません。いきなり複数の要素を含む必要が出てきて、回路はごちゃごちゃし始めるでしょう。

部品が増えるということは、制御するためのコードも増えてきます。ライブラリを使ったり、入出力のためのピン指定を行い、適切な周期・タイミングで制御したり、取ってきた値を加工したり、液晶や外部のネットワークに対して読み取り・書き込みを行ったり。そしてそれらの結果を、シリアルモニタや液晶モニタ等に表示する必要があります。この中で通信を扱うとき、何かミスがあれば想定通りの挙動を示しません。何か間違った表示をするならまだしも情報がありますが、ちょっとしたことでうんともすんともいわないように見えてしまうことも少なくありません。後述するように通信はミスが生じやすく、かつ何が間違っているのかわかりづらいという大変厄介なものです。

素子を壊すといったことはめったに起こりませんが、使い方を間違えると、やはり素子を壊してしまう可能性はあります。Lチカするだけでも、電流制限抵抗を入れないと電流を流しすぎ、素子の寿命を縮めたり、場合によっては本体を壊すことだってあり得ます。

このように、Lチカの次のステップに進む場合、たいてい大きな断崖が生じます。

### パワー系ムズイ

小さなマイコンで、大きなものを動かすのは夢がありますね。実際リレーや半導体素子を適切に利用することで、比較的簡単にモーターなどの装置を動かすことができます。

では、直接マイコンでモーターのような負荷を動かせるかというと、これは不可能です。例えばArduinoで直接モーターを回すことができるか考えてみましょう。ミニ四駆に使われるような小型モーターでも、電流は1100mA程度とされています。一方で、Arduinoの出力端子の定格は最大40mAです。これを超えると、マイコンが破壊に至る可能性があります。マイコンにとっては、出力とGNDを直結(ショートさせた)ようなものになり、電流を引き出しすぎるため破壊に至ります。

ではどうするかというと、先に述べたように、リレーやトランジスタなどを使って、マイコンの出力でこれらの素子を「スイッチ」として使い、「重い負荷」を制御します。機能としての設計の「イメージ」は当初はこれで十分ですが、詳細設計を行うには、マイコンの仕様、スイッチになる素子の仕様、負荷の仕様をきちんと検討したうえで、適切な設計をする必要があります。

単純に要素が増えるので難しいのと、情報が断片的になってしまいます。また、重い負荷はたいていの場合、過渡応答も考慮する必要があります。突入電力や回生電力なども考慮する必要がある場合があります。これらを考慮しないと「動くはずなのに上手く動かない」「動いたり動かなかったり」あるいは、「突然素子が死ぬ」といった現象に悩まされる可能性があります。どこかで展示するために持って行ったりしたら、その先で動かない、といったことも。

いつでも同じように動くことが理想ですが、構成要素が複雑になれば動かない確率は飛躍的に上がっていきます。





### センサームズイ
ここではセンサーを外部から情報を得る手段と定義します。温度や湿度、CO2などのガス濃度、臭いや明るさ、色、その他様々なセンサがあります。圧力や接触を検知するものもありますし、距離や形状を測定するセンサもありますね。

人が知覚できること、あるいは人には知覚できないことがありますが、いずれにせよ、何らかの情報をマイコンに教える手段であると考えてください。であれば、操作したことを教えるという意味で単純なスイッチですらセンサといっていいかもしれません。また通信によって情報が届くことも、この文脈ではセンサといっていいかも知れません。

さて、センサを使うためには、センサ素子そのものがあって、配線があって、電源があって、それを使うコードがあり、何らかの方法で表示するということになります。ということは、センサだけの話に限りませんが、どこか一つにミスがあれば正常に動かないということ。センサ（+センサ電源)→配線→（センサとの通信のコード)→マイコン→（表示の通信のコード）→配線→表示デバイス（+表示の電源)と、9個の要素があったとします。それぞれの場所で不具合が生じる可能性が10%あったとしましょう。単体要素が動く可能性は90%ですが、9個の要素がすべて正しく動く必要があるため、その可能性は39%程度（=0.9＾9)まで下がります。動く確率は半分以下ということ！

ちゃんと動くものを作るのはそれだけ大変。そして、配線などは、はんだ不良やブレッドボードの接触不良などで「経時的に」変化しえます。さっきまで動いてたのに！といったことが起こりえます。

またセンサによっては、間歇動作させないと壊れてしまうセンサもあります。

例えば臭いセンサなどがそれにあたります。臭いセンサは瞬間的に通電・加熱してセンサエレメントの抵抗値を読むセンサです。これを常時通電すると、焼損する可能性があります。プログラムのミスで長時間通電してしまったらどうでしょう？

### 通信ムズイ
もう一つの鬼門は通信です。マイコン/電子工作界隈でよく使われる通信には、UART、I2C、SPIなどがあります。これらはいずれも有線で、センサや液晶などの表示デバイス、あるいはSDカードのようなデータ保存デバイスとの通信を担います。

2線や3線、4線での通信を行うので、その分の配線が必要ですし、本体とデバイスのそれぞれの指定のピンを正しく接続することが必要です。線が外れていたり、接触不良だったり、また通信設定(UARTの通信速度やパリティなど)もきちんと合わせる必要があります。

また、適切なライブラリを使わないと、そもそも通信ができなかったりします。もちろん一から全部定義してやるのも可能ですが、最初にそれをやろうとするは死の道です。まずは通信に必要なライブラリを適切に導入して、さっくり使い始めるところから始めましょう。通信ができないと、ボード単体でやるしかなくなり、例えるなら真っ暗闇で手探りで探検するようなもの。ですが、その液晶を取り付けて動かすためにも通信は必須です。

### 画面表示には通信必須
プログラムを書いたら、動いているかどうかを確認する必要があります。想定通りの動きをしているのかしていないのかがわからないと、電源が入っているのかすらわかりません。それは、例えば処理をしていることをLEDで知らせるという程度でも有用です。ある一連の処理が終わるときに1ステップごとにLEDをチカチカさせる処理を入れたとしましょう。何回目で固まるのか、逆にどこで失敗しているのか、といったことを確かめる参考になります。

また、液晶があれば、処理状況などを文字として表示することも可能です。
自分の一挙手一投足に適切に反応してくれる液晶などのデバイスはよほどでない限り必ずつけておくことをおすすめします。

ところが、このような表示デバイスを使うためには、通信が必須です。しかも、素子単体のデータシートはかなり難解です。
これを読み解いて実際に使えるように実装するのはかなり大変です。

先に解を述べておくと、有名なデバイスなら大抵(ほぼ99%以上)公開されている使いやすいライブラリがあります。


### データシート読めない
データシートを読んだことはありますか？素子の特徴や電気的特性、通信が必要な場合はその通信の仕様などが書かれています。あるいは、オペアンプなどのように、様々な周波数で用いる素子の場合には周波数特性が、センサならば感度や直線性に関するデータが書いてあるでしょう。ある程度読みなれないと、どこを読めばよいのかすら不明です。

また、液晶などの表示デバイス、通信で読むタイプのセンサなどは、通信仕様が書いてあります。よく使うキャラクタ液晶16文字×2行の秋月のデータシートを見てみましょう。

https://akizukidenshi.com/catalog/g/gM-09109/

Ｉ２Ｃ接続小型ＬＣＤモジュール（８×２行）ピッチ変換モジュール（完成品）

これは、700円で購入可能な8文字×2行のキャラクタ液晶モジュールです。

このデータシートには、16進数またはバイナリで表示する方法や、初期化する方法等が情報として書かれています。しかし、果たしてこのデータシートを読んでどれだけの人が動かせるでしょうか。

また、もう一つの例として、適当なADCのデータシートを見てみましょう。ADC(Analog to Digital Converter:アナログ値をデジタル値に変換して取り込むモジュール)もよく使われますが、生値では12bitないしは16bitのバイナリ値が取れるだけであって、電圧値として取り込む場合には、適宜変換してやる必要があります。

なお、これらはいずれも、そのデバイスに合致するライブラリを使わない場合の話で、実用的には適当なライブラリを使いましょう。そのデバイスへの理解を極める、といった目的以外では、基本的には一から実装するメリットはありません。変換速度などのクリティカルな制約がある用途では有用かもしれませんが、そもそもそういう用途に対して本書で取り上げるようなマイコンを選択するのは適当なのか、という観点で再検討が必要です。

### 部品ストックが大変

ある程度の規模の作品を作ろうと思うと、様々な部品ストックをしておく必要が生じます。このストック部品を持っておくのも案外大変です。

抵抗やコンデンサなどの部品は個別に入手するのは案外大変です。1個当たりは安価なのですが、安価だからこそ、100個パックのような使いきれないほどのセットで購入する必要があるか、数個だけ購入するかの選択になります。秋月電子などでは1袋100本入りが100円といった価格で販売されていますが、逆に言うと1本2本使いたいときでも100本購入する必要があリます。

バラ売りしているお店もありますが、その場合単価が上がってしまいます。またその時だけ使う分を買うと、はんだ付けのミスなどで足りなくなってしまう、なんてことになります。また送料もバカになりません。

秋葉原在住、あるいは通勤経路に秋葉原がある（他の電気街でもOKですが）といった状況でもなければ、細かい部品を都度入手するのは案外大変です。発注も面倒ですし、都度注文して届くまで待つ間にモチベーションは削られてしまいます。

思いついたらすぐ作業に入れる環境というのは貴重ですし、構築・維持はなかなか大変です。

## 電子回路は実はそんなに難しくない

さて、ここまでほとんど電子回路の話をしてきていません。本書で想定する電子回路・素子は、実はそれほど難しくありません。

逆説的ですが、回路や素子そのものは、オームの法則に基づき動作すると思ってほぼ問題ありません。かろうじて、キャパシタ(コンデンサ)が入ることもありますが、キャパシタの過渡応答が問題になることはほとんどないでしょう。

キャパシタはほとんどの場合、フィルタまたはノイズフィルタ(パスコン:バイパスコンデンサ)