# ペットフードディスペンサーをIoT化　～製作レシピ例～

IoTLTでの懇親会で「外出や出張・旅行で家を不在にする際のペットのエサやりどうしてる？！」という話題になったことを思い出した。うちにも野良ネコ(ゆき)が一匹いるので旅行の際はいつも悩んでいる。

![ゆき](images/Recipe-IoTCatFoodDispenser/cat.png?scale=0.3)

選択肢としては、

* ペットシッター
* ペットホテル
* 留守番

がある。

普段の外出や短期間(1泊2日程度)の出張・旅行であれば留守番となり、中位・低位機種のデジタルタイマーのペットフィーダー[^feeder1] やアナログタイマーのトレイタイプ[^feeder2]を併用している。上位機種はカメラ付きスマホ遠隔操作自動給餌器[^feeder3]もある。

[^feeder1]: ペット用自動給餌器ルスモ　http://www.lusmo.com/
[^feeder2]: PetSafe おるすばんフィーダー2食分 https://store.intl.petsafe.net/ja-jp/2-meal-pet-feeder
[^feeder3]: カメラ付き自動給餌器”ビストロわんにゃん”スマートペットフィーダー https://bestanswer.shop-pro.jp/?pid=133686464


ペットおよび飼い主にとって最適な方法を考えてみる。

* エサやりは確実に行いたい
    * 停電時でも電池式のデジタルタイマーまたはアナログタイマーでエサやり
    * 足りなさそうな時は遠隔からエサやり
* ネコの様子を見たい
    * カメラの映像を遠隔(スマホまたはタブレット)から確認
* 一緒に遊んであげたい
    * ネコじゃらしで遊ぶ
* はんだを使わずに電子工作をする
* ノンコーディングで実現する

## 構成
外出先からスマホまたはタブレットのブラウザ操作で自宅のネコの様子を確認したり、ネコじゃらしで遊んだり、エサやりを行えるようにする。自宅のラズパイにカメラ、ペットフィーダー(LUSMO)を接続し、ラズパイへインストールされたソフトウェア(Node-RED)をインターネットから制御することで実現する。NAT越え問題[^nat]を解決するためにngrokのサービスを利用する。

[^nat]: 家庭内ネットワーク(LAN)とインターネット(WAN)の間に境界(NAT)が存在し、セキュリティを確保する目的でWAN→LANのアクセスは基本的に制限されている。

![技術要素と構成](images/Recipe-IoTCatFoodDispenser/components.png?scale=0.3)

### 材料
* LUSMO x 1
* ラズパイ(Raspberry Pi 3 Model B または B+) x 1
    * microSDHCカード(16GB Class10) x 1
    * ラズパイ用ACアダプター(5V / 3.0A) x 1
    * カメラモジュール(Raspberry Pi Camera v1.3 または v2.1) x 1
* サーボモーター(SG-90) x 2
    * SG-90サーボ用2軸カメラマウント x 1
    * ジャンパーケーブル(オス - メス) x 6
    * Grove リレー x 1
    * Grove ジャンパー(メス)ケーブル x 1
    * ワニ口クリップコード x 2
* ドライバーセット

### 配線
ラズパイは有線LANまたは無線Wi-Fiでネットワークへ接続する。カメラモジュールはラズパイのCAMERA端子へ接続し、サーボモーターとGroveリレーはラズパイのGPIO端子へ接続する。

![結線ブロック図](images/Recipe-IoTCatFoodDispenser/connection.png?scale=0.3)

次